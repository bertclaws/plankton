target-version = "py311"
line-length = 120
src = ["src", "tests"]
exclude = [".venv", "build", "dist"]

[lint]
preview = true # Required for PLR0917, PLR1702, and other preview PLR rules
select = [
  "A",    # flake8-builtins - prevent shadowing builtins
  "D",    # pydocstyle - docstring quality enforcement
  "E",
  "F",
  "I",
  "B",
  "C901",
  "PLR",  # All Pylint Refactor rules (single source of truth for hook)
  "FAST", # FastAPI best practices
  # Modernization categories for Python 3.11+ syntax
  "UP",   # pyupgrade - modern type annotations, syntax upgrades
  "RUF",  # ruff-specific - ruff's own rules for code quality
  "FLY",  # flynt - f-string conversions (preventive, 0 current violations)
  "FURB", # refurb - modern Python idioms
  # Security and type-checking categories
  "S",    # flake8-bandit - security vulnerability detection
  "TC",   # flake8-type-checking - optimize type-only imports
  # Style categories for code clarity
  "RET",  # flake8-return - unnecessary assignments/else
  "SIM",  # flake8-simplify - code simplification
  "TID",  # flake8-tidy-imports - absolute imports
  "TRY",  # tryceratops - exception handling
  # Naming conventions
  "N",    # pep8-naming - PEP 8 naming convention enforcement
  # Logging, Performance, and Code Quality categories
  "LOG",  # flake8-logging - proper logger usage
  "G",    # flake8-logging-format - f-string and exc_info patterns
  "ERA",  # eradicate - remove commented-out code
  "PERF", # Perflint - performance anti-patterns
  "ARG",  # flake8-unused-arguments
  "PLC",  # Pylint Convention
  "PLE",  # Pylint Error
  "PGH003",  # pygrep-hooks - blanket type: ignore detection
  "PGH004",  # pygrep-hooks - enforce specific rule codes in noqa
  "PLW",  # Pylint Warning
  # Testing category
  "PT",   # flake8-pytest-style - pytest best practices
]
ignore = [
  "PLC0415",  # import-outside-top-level - intentional pattern for:
              # - Circular import avoidance
              # - Pydantic validator optimization
              # - Lazy loading for optional dependencies
  "RUF100",   # unused-noqa - false positives on valid noqa comments
              # Known ruff issue: reports "non-enabled" for rules that DO trigger
              # See: github.com/astral-sh/ruff/issues/10906, #12591
]

[lint.mccabe]
max-complexity = 10 # Industry standard; functions >10 have exponentially more test paths

[lint.pylint]
max-args = 5            # PLR0913: too-many-arguments (forces @dataclass usage)
max-positional-args = 5 # PLR0917: too-many-positional-arguments (preview)
max-statements = 50     # PLR0915: too-many-statements (~1-2 screens)
max-branches = 12       # PLR0912: too-many-branches
max-returns = 6         # PLR0911: too-many-return-statements
max-nested-blocks = 5   # PLR1702: too-many-nested-blocks (preview)

[lint.isort]
known-first-party = ["app"]


[lint.per-file-ignores]
# PT (flake8-pytest-style) rules are pytest-specific - only apply to test files
"!tests/**/*" = ["PT"]
# Test files: D103 exempt (test function names ARE documentation)
"tests/**/test_*.py" = ["D103", "E", "F", "B", "C901", "PLR", "S", "TC", "N", "ARG", "RUF029", "ERA001", "PLC", "SIM", "TRY", "RET", "RUF", "PLW", "UP", "PERF", "FURB"]
"tests/**/conftest.py" = ["S", "N", "ARG", "PLC2701", "PLC0415", "SIM", "TRY", "RET", "RUF", "PLW", "TC", "UP", "PERF", "FURB", "E", "G"]
"tests/constants.py" = ["D", "ERA001"]


[lint.flake8-pytest-style]
# Extend PT011 (pytest-raises-too-broad) to require match= for additional exceptions
# Default list: BaseException, Exception, ValueError, OSError, IOError, EnvironmentError, socket.error
raises-extend-require-match-for = [
    "pydantic.ValidationError",
    "pydantic_core._pydantic_core.ValidationError",  # Pydantic v2 internal
    "AttributeError",
    "FileNotFoundError",
    "asyncio.CancelledError",
]

[lint.pydocstyle]
convention = "google"  # Matches project docstring style
